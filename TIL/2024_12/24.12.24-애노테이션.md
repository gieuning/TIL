# 2024-12
---

# 오늘 공부 내용

<details>
  <summary>생성자를 이용한 의존성 주입</summary>

  ```java
package com.anno.user1;

import org.springframework.beans.factory.annotation.Autowired;

public class User2 {

  private UserService userService;

  // 생성자를 이용한 의존성 주입
  // 스프링 5.1 이상부터는 <context:annotation-config />가 설정되어 있는 경우 생성자를 이용한 의존성 주입에서 @Autowired 생략가능
  @Autowired
  public User2(UserService userService) {
    this.userService = userService;
  }

  public void write() {
    String s = userService.message();

    System.out.println("-- 애노테이션 : 생성자를 이용한 의존관계 설정 -- ");
    System.out.println(s);
  }
}
   ```

</details>

`<context:component-scan base-package="com.anno.user6"/> ` 는 
@Component @Service, @Controller, @RestController, @Repository등의 스트레오 타입 애노테이션 활성화 
@Autowired, @Resource 등의 애노테이션도 활성화 

`	<context:component-scan base-package="com.anno.user7" use-default-filters="false">
		<context:include-filter type="annotation" expression="org.springframework.stereotype.Service"/>
	</context:component-scan>`
- user-default-filters="false" : 컴포넌트를 자동으로 스캔하지 않는다. 
- expression="org.springframework.stereotype.Service" : @Service만 스캔, @Component로 수정 시 모두 검색 

- @Component("user.userService") // 빈의 이름 설정
- @Primary : 하나의 빈을 기본 빈으로 지정 
- @Service 

### 📦 컴포넌트 스테레오타입 애노테이션

| **애노테이션**      | **목적**                                                                  |
|---------------------|-------------------------------------------------------------------------|
| `@Component`        | 스프링 컨테이너에 일반적인 빈(Bean)을 등록할 때 사용. (빈의 이름이 동일한 것이 두개 이상 있으면 예외)          |
| `@Service`          | 비즈니스 로직을 수행하는 서비스 계층의 빈을 등록할 때 사용.                                      |
| `@Repository`       | 데이터 접근 계층(DAO)의 빈을 등록할 때 사용. 데이터베이스 예외를 스프링 예외로 변환.                     |
| `@Controller`       | 웹 애플리케이션의 컨트롤러 빈을 등록할 때 사용.                                             |
| `@RestController`   | RESTful 웹 서비스의 컨트롤러 빈을 등록할 때 사용. `@Controller`와 `@ResponseBody`를 합친 형태. |

### 🔗 의존성 주입 애노테이션

| **애노테이션**      | **목적**                                                                                       |
|---------------------|------------------------------------------------------------------------------------------------|
| `@Autowired`        | 스프링이 자동으로 빈을 주입하도록 지정. 기본적으로 타입 기준으로 주입.                           |
| `@Qualifier`        | 동일한 타입의 빈이 여러 개일 때 특정 빈을 지정하여 주입.                                         |
| `@Inject`           | JSR-330 표준의 의존성 주입 애노테이션. `@Autowired`와 유사.                                     |
| `@Named`            | JSR-330 표준의 빈 이름 지정 애노테이션. `@Qualifier`와 유사.                                    |
| `@Resource`         | JSR-250 표준의 의존성 주입 애노테이션. 빈 이름을 기준으로 주입.                                   |

### 🛠️ 설정 관련 애노테이션

| **애노테이션**      | **목적**                                                                                       |
|---------------------|------------------------------------------------------------------------------------------------|
| `@Configuration`    | 스프링 설정 클래스를 지정. 빈 정의를 자바 코드로 작성할 때 사용.                                |
| `@Bean`             | 메서드가 반환하는 객체를 스프링 빈으로 등록. `@Configuration` 클래스 내에서 주로 사용.           |
| `@ComponentScan`    | 특정 패키지를 스캔하여 컴포넌트 스테레오타입 애노테이션이 있는 클래스를 자동으로 빈으로 등록.    |
| `@PropertySource`   | 외부 프로퍼티 파일을 스프링 환경에 추가.                                                     |

### 🌀 AOP 관련 애노테이션

| **애노테이션**      | **목적**                                                                                       |
|---------------------|------------------------------------------------------------------------------------------------|
| `@Aspect`           | AOP의 관점(Aspect)을 정의.                                                                       |
| `@Before`           | 지정된 조인 포인트 전에 어드바이스를 실행.                                                        |
| `@After`            | 지정된 조인 포인트 후에 어드바이스를 실행.                                                        |

### ⚙️ 트랜잭션 관리 애노테이션

| **애노테이션**      | **목적**                                                                                       |
|---------------------|------------------------------------------------------------------------------------------------|
| `@Transactional`    | 메서드나 클래스에 트랜잭션 경계를 설정. 자동으로 트랜잭션을 시작하고 커밋 또는 롤백.              |
| `@EnableTransactionManagement` | 스프링의 트랜잭션 관리 기능을 활성화.                                           |

### 🧰 기타 유용한 애노테이션

| **애노테이션**      | **목적**                                                                                       |
|---------------------|------------------------------------------------------------------------------------------------|
| `@Value`            | 프로퍼티 값을 주입.                                                                             |
| `@RestControllerAdvice` | 전역 예외 처리, 바인딩, 데이터 바인딩 등의 어드바이스를 제공.                                  |

## AOP
- 애플리케이션의 핵심 비즈니스 로직과 공통적으로 적용되는 부가 기능을 분리하여 코드를 모듈화하는 프로그래밍 패러다임
- 객체 지향 프로그래밍을 보완하는 패러다임으로, 핵심 비즈니스 로직과 횡단 관심사를 분리하여 모듈화하는 프로그래밍 기법

### 횡단 관심사
- 여러 모듈에 걸쳐 공통적으로 적용되는 관심사
- 예) 로깅, 트랜잭션 관리, 인증/인가, 캐싱 등.

### 핵심 관심사
- 애플리케이션의 주요 비즈니스 로직
- AOP는 핵심 관심사에 영향을 주지 않고 횡단 관심사를 처리하는 데 초점을 맞춤 

AOP의 결론 - 관심사를 분리하여 가독성, 유지보수성, 재사용성을 향상

## AOP 동작 원리
1. Target 클래스
- 실제 핵심 비즈니스 로직을 수행하는 클래스와 메서드.
2. Advice 정의
- 특정 로직 실행 전, 후, 예외 발생 시에 실행될 공통 로직을 작성.
3. Pointcut 설정
- Advice가 적용될 메서드를 식별하기 위해 표현식을 사용하여 규칙 설정.
4. Advisor 구성
- Advice와 Pointcut을 연결하여 특정 조건에서 Advice를 실행.
5. Proxy 생성 및 실행
- 스프링 AOP 프록시가 Target 객체를 감싸고 Join Point에서 Advice 실행.

<details>
<summary>XML 예시 코드</summary>

```xml
 <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd">

    <!-- Target 클래스 -->
    <bean id="target" class="com.example.Target"/>

    <!-- Advice 클래스 -->
    <bean id="loggingAdvice" class="com.example.LoggingAdvice"/>

    <!-- Pointcut 정의 -->
    <aop:config>
        <aop:pointcut id="writePointcut" expression="execution(* com.example.Target.write(..))"/>

        <!-- Advisor 구성 -->
        <aop:advisor advice-ref="loggingAdvice" pointcut-ref="writePointcut"/>
    </aop:config>
</beans>
```

</details>

<details> 
<summaery>자바 코드 예제</summaery>

```java
- Target 클래스 
@Component
public class Target {
    public void write(String data) {
        System.out.println("Writing data: " + data);
    }
}

- Advice 클래스
@Aspect
@Component
public class LoggingAdvice {

  @Before("execution(* com.example.Target.write(..))")
  public void beforeAdvice() {
    System.out.println("Before writing data.");
  }

  @After("execution(* com.example.Target.write(..))")
  public void afterAdvice() {
    System.out.println("After writing data.");
  }
}

- Java Config
    
@Configuration
@EnableAspectJAutoProxy
@ComponentScan(basePackages = "com.example")
public class AppConfig {
}

- Main 클래스
public class Main {
  public static void main(String[] args) {
    ApplicationContext context = new AnnotationConfigApplicationContext(AppConfig.class);
    Target target = context.getBean(Target.class);
    target.write("Hello, AOP!");
  }
}
```
--- 
실행 결과 
Before writing data.
Writing data: Hello, AOP!
After writing data.
</details>

### 🌀 AOP 주요 개념

| **개념**            | **설명**                                                                                     |
|---------------------|---------------------------------------------------------------------------------------------|
| Aspect              | AOP의 단위로, 관심사의 모듈화. 어드바이스와 포인트컷을 포함.                                  |
| Advice              | 조인 포인트에서 실행되는 작업. `@Before`, `@After`, `@Around` 등으로 정의.                     |
| Pointcut            | 어드바이스가 적용될 하나 이상의 조인 포인트를 정의하는 표현식.                                 |
| Join Point          | 어드바이스가 적용될 수 있는 특정 실행 지점 (예: 메서드 호출).                                  |
| Target Object       | 어드바이스가 적용되는 실제 객체.                                                              |
| Proxy Object        | AOP 프록시가 생성한 객체. 타겟 객체를 대신하여 요청을 처리.                                   |
| Weaving             | Aspect와 Target Object를 결합하는 과정. (컴파일 타임, 로드 타임, 런타임 등)                   |

---

### 🌀 AOP 표현식 (Pointcut)

| **표현식**          | **설명**                                                                                     |
|---------------------|---------------------------------------------------------------------------------------------|
| `execution`         | 메서드 실행 조인 포인트를 지정. 메서드 이름, 리턴 타입, 매개변수 등을 포함 가능.                |
| `within`            | 특정 타입(클래스 또는 패키지)의 모든 조인 포인트를 지정.                                       |
| `this`              | 프록시 객체의 타입과 일치하는 조인 포인트를 지정.                                              |
| `target`            | 대상 객체의 타입과 일치하는 조인 포인트를 지정.                                                |
| `args`              | 전달된 인수의 타입과 일치하는 조인 포인트를 지정.                                              |
| `@annotation`       | 특정 애노테이션이 적용된 조인 포인트를 지정.                                                   |

---

### 🌀 AOP 관련 애노테이션

| **애노테이션**      | **목적**                                                                                     |
|---------------------|---------------------------------------------------------------------------------------------|
| `@Aspect`           | AOP의 관점(Aspect)을 정의. AOP를 사용하려면 클래스에 이 애노테이션을 추가해야 함.            |
| `@Before`           | 지정된 조인 포인트 전에 어드바이스를 실행.                                                   |
| `@After`            | 지정된 조인 포인트 후에 어드바이스를 실행.                                                   |
| `@AfterReturning`   | 조인 포인트가 정상적으로 완료된 후 어드바이스를 실행. 반환 값을 처리할 수 있음.                |
| `@AfterThrowing`    | 조인 포인트에서 예외가 발생했을 때 어드바이스를 실행.                                         |
| `@Around`           | 조인 포인트 전후에 어드바이스를 실행. 메서드 실행 제어 및 반환 값을 변경 가능.                 |
| `@Pointcut`         | 재사용 가능한 포인트컷(조인 포인트를 지정하는 표현식)을 정의.                                 |

---


### 🌀 AOP 설정 관련 애노테이션

| **애노테이션**      | **목적**                                                                                     |
|---------------------|---------------------------------------------------------------------------------------------|
| `@EnableAspectJAutoProxy` | AOP 프록시를 활성화. Spring AOP 설정 시 필수.                                                |

---

## AOP의 주요 Advice 
- MethodBeforeAdvice: 대상 객체의 메서드 실행 전에 공통 기능을 실행. 메서드 실행 전 데이터 검증, 로깅, 데이터베이스 연결 설정 등에 사용.
- AfterReturningAdvice: 대상 객체의 메서드 실행 후 공통 기능을 실행. 예외 없이 성공적으로 실행된 경우에만 적용. 결과 로깅, 트랜잭션 커밋, 리소스 정리에 유용.
- MethodInterceptor: 메서드 실행 전, 후, 또는 예외 발생 시점에서 공통 기능을 실행. Before, AfterReturning, ThrowAdvice를 하나로 묶어 관리 가능.

---

예제 시나리오
Target: 실제 작업을 수행하는 핵심 클래스와 메서드 (예: write 메서드).

write 메서드는 데이터를 삽입(insert)하는 작업을 수행하며, 이 작업을 수행하려면 데이터베이스 연결 객체(conn)가 필요하다.

Advice: 부가적으로 실행할 작업. 여기서 conn 객체를 활용해 데이터베이스 연결을 설정하거나, 트랜잭션을 관리하는 역할을 한다.

Pointcut: 특정 메서드(write)에서만 conn을 실행하도록 지정하는 규칙입니다. 이 규칙은 AOP 표현식으로 정의된다.

Advisor: Advice와 Pointcut을 연결하는 구성 요소로, write 메서드에서만 특정 Advice가 실행되도록 설정한다.
